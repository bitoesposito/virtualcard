<p-toast class="absolute" />

<nav class="px-3 mt-3 text-color w-full flex justify-content-between align-items-center m-auto"
    style="max-width: 1200px;">
    <div>
        <img src="./logo-full.svg" alt="vcarder_logo" height="50" />
    </div>
    <div class="flex gap-2 align-items-center">
        <div [routerLink]="['/private/edit']" routerLinkActive="router-link-active" class="p-2 border-1 border-round-md surface-border sm:inline hidden ml-2 select-none cursor-pointer" pTooltip="Edit your profile" tooltipPosition="bottom">
            <i class="pi pi-user mr-2"></i>{{this.currentUserEmail}}
        </div>

        <i [routerLink]="['/private/edit']" routerLinkActive="router-link-active" class="pi pi-user p-2 border-1 border-round-md surface-border sm:hidden inline cursor-pointer" pTooltip="Edit your profile" tooltipPosition="bottom"></i>

        <p-button icon="pi pi-sign-out text-sm" label="Disconnect" severity="secondary" text="true"
            (click)="disconnect()" />
    </div>
</nav>

<main style="max-width: 1200px;" class="m-auto flex flex-column p-3 gap-3 mt-2">
    <header class="flex flex-column gap-2">

        <p class="text-2xl font-semibold">Dashboard</p>

        <div class="flex gap-2 w-full">
            <p-inputgroup class="w-full">
                <input pInputText placeholder="Search user..." class="w-full" />
                <p-inputgroup-addon>
                    <p-button icon="pi pi-search" severity="secondary" variant="text" severity="primary" />
                </p-inputgroup-addon>
            </p-inputgroup>

            <p-button icon="pi pi-user-plus" outlined="true" label="Create User" class="white-space-nowrap"
                (click)="toggleNewUserDialog()" />
        </div>
    </header>

    <content>
        @for (item of users; track $index) {
        <div
            class="flex w-full border-bottom-1 surface-border py-2 justify-content-between align-items-center cursor-pointer">
            <div class="flex flex-column" [routerLink]="['/private', item?.uuid]">
                <p class="font-semibold text-lg">{{item?.email}}</p>
                <p class="text-sm">{{item?.username}}</p>
            </div>
            <p-button severity="danger" icon="pi pi-trash" text="true"
                (click)="deleteUserDialog($event, item?.email)" />
        </div>
        } @empty {
        <p class="text-sm mt-3 text-color-secondary select-none">No users available</p>
        }
    </content>
</main>

<p-confirmdialog />

<p-dialog header="Create User" [modal]="true" [(visible)]="showNewUserDialog"
    [breakpoints]="{ '1199px': '70vw', '575px': '90vw' }" [style]="{ width: '30vw' }" draggable="false"
    [resizable]="false">
    <main>
        <form [formGroup]="form" (ngSubmit)="confirmCreationDialog($event)" class="flex flex-column gap-2 pb-2">
            <div class="flex gap-1 flex-column">
                <label for="email">Email Address</label>
                <input formControlName="email" type="email" pInputText placeholder="Enter email address" />
                <small class="text-color-secondary"
                    *ngIf="form.get('email')?.errors?.['required'] && form.get('email')?.touched">Email is required</small>
                <small class="text-color-secondary"
                    *ngIf="form.get('email')?.errors?.['email'] && form.get('email')?.touched">Please enter a valid email address</small>
            </div>

            <small class="text-color-secondary">Once created, the user will receive a verification email to access and configure their personal profile.</small>

            <div class="flex gap-2 flex-column mt-2">
                <p-button label="Create User" fluid="true" type="submit" [disabled]="!form.valid || loading"
                    [loading]="loading" />
            </div>
        </form>
    </main>
</p-dialog>